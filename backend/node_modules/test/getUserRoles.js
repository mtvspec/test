var pg = require('pg');

function _getUsersRoles() {
  return new Promise(function(resolve, reject) {
    pg.connect(function (err, client, done) {
      if (err) {
        reject({
          status: 500,
          message: err.message
        });
      } else {
        client.query({
          text: 'SELECT id, role_name AS "roleName", is_deleted AS "isDeleted" FROM users.e_roles ORDER BY id ASC;'
        }, function (err, result) {
          var rowCount;
          if (err) {
            reject({
              status: 500,
              message: err.message
            });
          } else {
            done();
            rowCount = result.rowCount;
            if (rowCount === 0) {
              resolve({
                status: 204,
                roles: []
              });
            } else if (rowCount > 0) {
              resolve({
                status: 200,
                roles: result.rows
              });
            }
          }
        });
      }
    });
  });
};

function getUsersRoles() {
  _getUsersRoles().then(
    function (resolve) {
      return resolve;
    }, function (reject) {
      return reject;
    }
  )
};

var usersRoles = getUsersRoles();
console.log(usersRoles);

function getUserRoles(userID) {
  return new Promise(function(resolve, reject) {
    pg.connect(function (err, client, done) {
      if (err) {
        console.log(err);
        reject({
          status: 500,
          error: error.detail
        });
      } else {
        client.query({
          text: 'SELECT u.user_id AS "userID", r.role_name AS "roleName" FROM users.r_e_user_e_roles u, users.e_roles r WHERE u.role_id = r.id AND user_id = $1;',
          values: [userID]
        }, function (err, result) {
          var rowCount;
          if (err) {
            console.log(err);
            reject({
              status: 500,
              error: error.detail
            });
          } else {
            done();
            rowCount = result.rowCount;
            if (rowCount === 0) {
              resolve({
                status: 204,
                roles: []
              });
            } else if (rowCount > 0) {
              resolve({
                status: 200,
                roles: result.rows
              });
            }
          }
        });
      }
    });
  });
};

getUserRoles(3).then(
  function (success) {
    console.log(success);
  }, function (failure) {
    console.log(failure);
  }
);
