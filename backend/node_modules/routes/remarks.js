var RemarksRouter = require('express').Router(),
DBQueries = require('../db/DBQueries.js'),
Controller = require('../controller'), PGController = new Controller(),
DBService = require('../db/DBService.js'), PGService = new DBService();

RemarksRouter
.route('/')
.get(function (request, response) {
  PGService.performQueryWL(
    DBQueries.selectRemarksQuery(),
    PGService.selectRecordsWL,
    function (status, data) {
      return response.status(status)
      .json(data).end();
    }
  );
})
.post(function (request, response) {
  if (!request.body) {
    console.log('body');
    return response.status(400).end();
  }
  var remark = {
    authorID: String(request.body.authorID),
    objectID: Number(request.body.objectID),
    remarkText: String(request.body.remarkText),
    responsiblePersonID: String(request.body.responsiblePersonID)
  };
  console.log(remark);
  if (PGController.validate(remark, 'remarkData')) {
    console.log('validated');
    PGService.performQueryWL(
      DBQueries.insertRemarkQuery(remark),
      PGService.insertRecordWL,
      function (status, data) {
        return response.status(status)
        .json(data).end();
      }
    );
  } else {
    console.log('controller');
    return response.status(400).end();
  }
})

module.exports = RemarksRouter;
