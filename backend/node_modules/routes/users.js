'use strict';

var UsersRouter = require('express').Router(),
DBQueries = require('../db/DBQueries.js'),
Controller = require('../controller'), PGController = new Controller(),
DBService = require('../db/DBService.js'), PGService = new DBService();

UsersRouter

.post('/login', function (request, response) {
  if (!(request.body.username && request.body.password)) {
    return response.status(400).end();
  }

  var user = {
    /* required */
    username: String(request.body.username),
    /* required */
    password: String(request.body.password)
  },
  log = {
    session_id: 1,
    manipulation_type_id: 'SELECT'
  };

  if (PGController.validate(user, 'user')) {
    console.log(user);
    PGService.performQuery(
      DBQueries.selectUserQuery(user),
      DBQueries.selectUserQueryLog(log),
      DBService.selectRecord,
      function (status, data) {
        return response.status(status)
        .json(data).end();
      }
    );
  } else {
    return response.status(400).end();
  }

})

.post('/logout', function (request, response) {
  // body...
})

module.exports = UsersRouter;
