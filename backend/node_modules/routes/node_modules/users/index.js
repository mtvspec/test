'use strict';

var UsersModel = [],
UsersService = require('./UsersService.js'), PersonsService = require('../persons/PersonsService.js');

/**
* @function fetch all users
* @return users
* @function fetch all users persons
* @param users
* @return users
* @function fetch all users roles
* @param users
* @return users
*/

if (UsersModel.length === 0) {
  UsersService.getUsers().then(
    function (resolve) {
      for (var i = 0; i < resolve.users.length; i++) {
        UsersModel.push({
          userID: resolve.users[i].id,
          credentials: {
            username: resolve.users[i].username,
            password: resolve.users[i].password
          },
          status: 'offline',
          roles: [],
          person: {
            id: resolve.users[i].id
          },
          defaultRoleID: resolve.users[i].defaultRoleID,
          isBlocked: resolve.users[i].isBlocked,
          isDeleted: resolve.users[i].isDeleted
        });
      }
      for (var i = 0; i < UsersModel.length; i++) {
        PersonsService.getPerson(UsersModel[i].person.id).then(
          function (resolve) {
            UsersModel[i].person = resolve.person;
          }, function (reject) {
            console.error('getPerson:\n', reject.status, reject.message);
          }
        )
      }
    }, function (reject) {
      console.error('getUsers:\n', reject.status, reject.message);
    }
  );
}

module.exports = UsersModel;
