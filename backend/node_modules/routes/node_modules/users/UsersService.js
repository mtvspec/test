'use strict';

var pg = require('pg');

var UsersService = {
  getUsers: function getUsers() {
    return new Promise(function(resolve, reject) {
      pg.connect(function (err, client, done) {
        if (err) {
          reject({
            status: 500,
            message: err.message
          });
        } else {
          client.query({
            text: 'SELECT id, person_id AS "personID", u_username AS "username", u_password AS "password", default_role_id AS "defaultRoleID", is_blocked AS "isBlocked", is_deleted AS "isDeleted" FROM users.e_users ORDER BY id ASC;'
          }, function (err, result) {
            var rowCount;
            if (err) {
              reject({
                status: 500,
                message: err.message
              });
            } else {
              done();
              rowCount = result.rowCount;
              if (rowCount === 0) {
                resolve({
                  status: 204,
                  users: []
                });
              } else if (rowCount > 0) {
                resolve({
                  status: 200,
                  users: result.rows
                });
              }
            }
          });
        }
      });
    });
  }
};

module.exports = UsersService;
